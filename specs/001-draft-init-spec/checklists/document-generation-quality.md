# ドキュメント生成品質要件チェックリスト

**作成日**: 2025-10-17
**対象**: `/speckit.doc-update` コマンドで生成されるエンドユーザー向けドキュメント
**目的**: 生成されたドキュメントが全くユーザーフレンドリーではない問題について、要件定義の品質を検証する
**焦点**: エンドユーザー向けドキュメント全体の要件品質
**深さ**: Detailed（詳細レベル）
**優先品質次元**: Completeness（完全性）

---

## Requirement Completeness（要件定義の完全性）

必要な要件がすべて定義されているかを検証する。

- [x] CHK001 - エンドユーザーの定義（非技術者、プロダクトマネージャー、営業チーム等の具体的なペルソナ）が要件として明確に定義されているか？[Gap] (Session 2025-10-17 Q1で「エンドユーザー（顧客、プロダクトマネージャー、営業チーム、サポートチーム）」と定義済み)
- [ ] CHK002 - 「ユーザーフレンドリー」の定義が測定可能な基準（文章の長さ、専門用語の割合、例示の有無等）として要件に含まれているか？[Gap] (SC-027は主観的評価)
- [x] CHK003 - 生成されるドキュメントの構造要件（必須セクション、推奨セクション、見出し階層、セクション順序）が明確に定義されているか？[Gap, Spec §FR-012] (FR-012, FR-015, FR-018で定義済み)
- [x] CHK004 - LLM変換の入力要件（ソースファイル形式、抽出ルール、トークン制限、文字コード）が完全に定義されているか？[Completeness, Spec §FR-038] (FR-038で10,000トークン制限、Session 2025-10-17 Q3で抽出ルール定義済み)
- [x] CHK005 - LLM変換の出力要件（Markdown形式、品質基準、最小/最大文字数、セクション構成）が明確に定義されているか？[Completeness, Spec §FR-038c] (FR-038cで品質基準4つ定義済み)
- [x] CHK006 - spec.md最小限抽出の具体的な実装方法（パーサー選択、セクション識別の正規表現またはASTパターン、エラーハンドリング）が要件として定義されているか？[Completeness, Spec §FR-038] (Session 2025-10-17 Q3: Option B - markdown-it-py使用)
- [x] CHK007 - LLM変換プロンプトの内容要件（変換の方向性、トーン、対象読者、禁止事項）が定義されているか？[Gap] (FR-038c, FR-038-integ-aで定義済み)
- [ ] CHK008 - ドキュメントの可読性要件（1文の最大文字数、段落の長さ、専門用語の扱い、サンプルコードの有無）が定義されているか？[Gap]
- [x] CHK009 - README.md/QUICKSTART.md/spec.mdの優先順位判断基準（どのような場合にどちらを使用するか）が明確に定義されているか？[Completeness, Spec §FR-038] (Session 2025-10-17で優先順位定義済み)
- [x] CHK010 - 生成されたドキュメントに含めるべき必須要素（タイトル、ステータス、概要、使い方、リンク等）が要件として定義されているか？[Gap] (FR-015, FR-018でFeature Filesセクション、リンク等を定義)
- [x] CHK011 - 除外すべき技術的コンテンツ（Clarificationsセクション、Success Criteria、技術的Q&A等）が明確に定義されているか？[Gap] (FR-012, FR-016, FR-017でplan.md/tasks.md除外を定義)
- [x] CHK012 - LLM変換の責務分担（AIエージェントとバックエンドスクリプトの役割境界）が明確に定義されているか？[Completeness, Spec §FR-022b] (FR-022b, Session 2025-10-16で定義済み)

## Requirement Clarity（要件の明確性）

要件が曖昧さなく具体的に定義されているかを検証する。

- [x] CHK013 - 「最小限の情報のみ抽出」の具体的な定義が明確か？（約4,500トークンという数値は明確だが、どのセクションをどの順序で抽出するかが曖昧）[Ambiguity, Spec §FR-038] (Session 2025-10-17 Q3で具体的な抽出ルール定義済み)
- [ ] CHK014 - spec.mdの「推奨構造」が明確に定義されているか？（セクション名の正確なパターン、階層レベル、必須/任意の区別、言語バリエーション）[Ambiguity, Spec §SC-022c] (一部定義あり、詳細は不足)
- [ ] CHK015 - LLM変換の「技術的表現を自然な文章に変換」の具体的な基準が定義されているか？（例：「MUST」→「できます」、受動態→能動態等のルール）[Ambiguity, Spec §FR-038] (概念的には記載あり、詳細ルールは不足)
- [x] CHK016 - 「エンドユーザー向けコンテンツ」と「技術者向けコンテンツ」の境界基準が明確に定義されているか？（キーワードリスト、セクション名パターン等）[Ambiguity, Spec §FR-012] (FR-012, FR-016, FR-017でplan.md/tasks.md除外を明示)
- [x] CHK017 - README/QUICKSTART不整合検出の「重大な矛盾」の判定基準が具体的に定義されているか？（技術スタック、機能説明、目的以外の基準）[Ambiguity, Spec §FR-038-integ-a] (FR-038-integ-aで技術スタック、機能、目的を定義)
- [x] CHK018 - セクション優先順位判定の基準（エンドユーザーにとっての重要度の判定方法）が明確に定義されているか？[Ambiguity, Spec §FR-038-integ-b] (Session 2025-10-17 Q3: LLMによる優先順位判定)
- [x] CHK019 - LLM生成コンテンツの品質チェック4基準（空文字列、最小文字数50、エラーパターン、Markdown構文）は十分な品質保証か？[Clarity, Spec §FR-038c] (FR-038cで4基準明示)
- [x] CHK020 - 「ユーザーストーリーの目的」セクションの識別パターン（正規表現、Markdown AST、セクション階層）が明確に定義されているか？[Ambiguity, Spec §FR-038] (Session 2025-10-17 Q3で`### ユーザーストーリーN:`パターン定義)
- [x] CHK021 - 前提条件セクションの範囲（どこから開始しどこで終了するか）が明確に定義されているか？[Clarity, Spec §FR-038] (Session 2025-10-17 Q3で`## 前提条件`セクション全体を抽出)
- [x] CHK022 - スコープ境界の抽出範囲（「スコープ外（フェーズ1 - MVP）」のみか、「スコープ内」も含むか）が明確に定義されているか？[Ambiguity, Spec §FR-038] (Session 2025-10-17 Q3で「スコープ外」のみ抽出)

## Acceptance Criteria Quality（受入基準の品質）

成功基準が客観的に測定可能かを検証する。

- [ ] CHK023 - 「ユーザーフレンドリー」の測定基準は客観的か？（SC-027の「80%以上の非技術者が理解しやすいと回答」は主観的評価である）[Measurability, Spec §SC-027]
- [ ] CHK024 - LLM変換の成功基準（変換率、品質スコア、ユーザー満足度等）が明確に定義され測定可能か？[Gap]
- [ ] CHK025 - ドキュメントの可読性を客観的に測定する基準（Flesch-Kincaid Reading Ease、文章の複雑度等）が定義されているか？[Gap]
- [ ] CHK026 - spec.md抽出の成功基準（抽出されたトークン数、セクション数、内容の網羅性）が測定可能か？[Measurability, Spec §FR-038]
- [ ] CHK027 - 生成されたドキュメントの完全性を検証する基準（必須セクションの有無、リンクの正確性、フォーマットの一貫性）が定義されているか？[Gap]
- [ ] CHK028 - LLM変換の品質を定量的に評価する基準（トーンの一貫性、専門用語の削減率、文章の簡潔性等）が定義されているか？[Gap]

## Scenario Coverage（シナリオカバレッジ）

すべてのシナリオとエッジケースが要件でカバーされているかを検証する。

- [ ] CHK029 - spec.mdにClarificationsセクション（技術的Q&A）が大量にある場合の処理要件が定義されているか？（現状：600行以上がそのまま出力される問題）[Coverage, Gap]
- [ ] CHK030 - spec.mdの構造が推奨構造と異なる場合（セクション名の変更、階層の違い等）の処理要件が定義されているか？[Coverage, Spec §SC-022c]
- [ ] CHK031 - README.md、QUICKSTART.md、spec.mdのすべてが存在する場合の優先順位要件が定義されているか？[Coverage, Gap]
- [ ] CHK032 - ユーザーストーリーが複数（5個以上）ある場合の抽出要件（すべて抽出するか、代表的なもののみか）が定義されているか？[Coverage, Spec §FR-038]
- [ ] CHK033 - 前提条件セクションが複数のサブセクション（フェーズ1、フェーズ2等）を持つ場合の抽出要件が定義されているか？[Coverage, Spec §FR-038]
- [ ] CHK034 - LLM API呼び出しが一時的に失敗した場合のリトライ要件（リトライ回数、待機時間、エラーメッセージ）が定義されているか？[Coverage, Exception Flow, Gap]
- [ ] CHK035 - 生成されたドキュメントが品質基準を満たさない場合の再生成要件が定義されているか？[Coverage, Recovery Flow, Gap]
- [ ] CHK036 - spec.mdの言語が混在（日本語と英語）する場合のLLM変換要件が定義されているか？[Coverage, Gap]

## Edge Case Coverage（エッジケースカバレッジ）

境界条件と異常ケースが要件で定義されているかを検証する。

- [ ] CHK037 - spec.mdに技術的セクション（Clarifications、Success Criteria、Implementation等）のみが含まれ、ユーザーストーリーや前提条件が存在しない場合の要件が定義されているか？[Edge Case, Gap]
- [ ] CHK038 - spec.md抽出後のコンテンツが最小文字数（50文字）未満になる場合の処理要件が定義されているか？[Edge Case, Spec §FR-038c]
- [ ] CHK039 - セクション単位統合ですべてのセクションを含めると10,000トークンを超える場合の優先順位判定要件が明確に定義されているか？[Edge Case, Spec §FR-038-integ-b]
- [ ] CHK040 - LLM変換結果に意図しないMarkdown構文（ネストしたリスト、複雑なテーブル等）が含まれる場合の検証要件が定義されているか？[Edge Case, Gap]
- [ ] CHK041 - 抽出されたセクションが空（ユーザーストーリーの目的が未記入等）の場合の処理要件が定義されているか？[Edge Case, Gap]
- [ ] CHK042 - LLM変換結果のトークン数が元のコンテンツより大幅に増加した場合（要約ではなく拡張された場合）の検証要件が定義されているか？[Edge Case, Gap]
- [ ] CHK043 - spec.mdのセクション見出しに番号が含まれる場合（例：「## 1. 前提条件」）の識別要件が定義されているか？[Edge Case, Gap]

---

## 優先度の高い問題（Top 10）

調査結果から、以下の要件が最も重要かつ緊急性が高い：

1. **CHK029** - Clarificationsセクション除外の要件欠如（現状の問題の直接原因）
2. **CHK002** - 「ユーザーフレンドリー」の測定可能な定義の欠如
3. **CHK007** - LLM変換プロンプトの内容要件の欠如
4. **CHK003** - ドキュメント構造要件の欠如
5. **CHK011** - 除外すべき技術的コンテンツの定義の欠如
6. **CHK037** - 技術的セクションのみのspec.md処理要件の欠如
7. **CHK015** - 「技術的表現を自然な文章に変換」の具体的基準の欠如
8. **CHK024** - LLM変換の成功基準の欠如
9. **CHK001** - エンドユーザーの明確な定義の欠如
10. **CHK014** - spec.mdの「推奨構造」の明確な定義の欠如

---

## 調査結果サマリー

### 根本原因

1. **LLM変換が実装されていない**: コマンドテンプレート（`.claude/commands/speckit.doc-update.md`）にはLLM変換のワークフローが記載されているが、実際の変換ロジック（Claude API呼び出し、プロンプト定義、品質チェック）が実装されていない

2. **spec.md構造の問題**: spec.mdは主にClarifications（技術的Q&A、約600行）で構成されており、これが生のまま出力されている。エンドユーザー向けの「概要」「使い方」「価値」などのセクションが存在しない

3. **コンテンツ抽出ロジックの不在**: spec.mdから「最小限抽出」（ユーザーストーリーの目的、前提条件、スコープ境界）が実装されていない。現状はspec.md全体（約600行）がテンプレートに渡されている

4. **要件の不明確さ**:
   - LLM変換プロンプトの具体的な内容が要件に定義されていない（CHK007）
   - 「ユーザーフレンドリー」の定義が曖昧（CHK002）
   - エンドユーザーの定義が不明確（CHK001）
   - 生成されるドキュメントの構造要件が定義されていない（CHK003）
   - 除外すべき技術的セクション（Clarifications等）が明確に定義されていない（CHK011）

### 影響範囲

- **ファイル**: `docs/draft-init-spec.md`（生成されたドキュメント）
- **問題**: 600行以上の技術的Q&A（Clarifications）が羅列され、エンドユーザーには全く理解できない内容
- **関連要件**: FR-038（LLM変換）、FR-012（コンテンツ抽出）、FR-015（ユーザーフレンドリーなコンテンツ）、SC-027（ユーザーテスト基準）

### 推奨アクション

1. **即座の対応**:
   - CHK011の要件を明確化：Clarifications、Success Criteria、Implementation等の技術的セクションを除外リストとして定義
   - CHK007の要件を追加：LLM変換プロンプトの内容要件を定義（トーン、対象読者、変換ルール）
   - CHK003の要件を追加：生成されるドキュメントの構造要件を定義（必須セクション、順序）

2. **短期的対応**:
   - CHK002の要件を明確化：「ユーザーフレンドリー」の測定可能な基準を定義
   - CHK001の要件を追加：エンドユーザーのペルソナを明確に定義
   - CHK029の要件を追加：Clarificationsセクションの処理方法を定義

3. **中長期的対応**:
   - CHK024の要件を追加：LLM変換の成功基準を定義
   - CHK037の要件を追加：技術的セクションのみのspec.md処理方法を定義
   - CHK014-CHK022の要件を明確化：spec.md構造とコンテンツ抽出ルールを詳細化
